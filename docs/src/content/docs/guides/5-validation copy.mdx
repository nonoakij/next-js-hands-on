---
title: 5. Server Action の引数のvalidation
description: 4. Server Action の引数のvalidation
---
import { Tabs, TabItem } from '@astrojs/starlight/components';
import { Aside } from '@astrojs/starlight/components';
import videoSrc from '../../assets/first-page.mov';

```diff lang="tsx"
// apps/workspace/app/actions.ts
"use server";
import { cookies } from "next/headers";
import { redirect } from "next/navigation";
+ import { type inferFlattenedErrors, z } from "zod";

+ const authSchema = z.object({
+   email: z.string().email(),
+   password: z.string().min(1),
+ });
+ type State = inferFlattenedErrors<typeof authSchema> | null;

- export async function auth(formData: FormData) {
-   const email = formData.get("email") as string;
-   const password = formData.get("password") as string;
+ export async function auth(state: State, formData: FormData): Promise<State> {
+   const parsedFormData = authSchema.safeParse(
+     Object.fromEntries(formData.entries()),
+   );
+   if (!parsedFormData.success) {
+     return parsedFormData.error.formErrors;
+   }
+ 
+   const { email, password } = parsedFormData.data;
  const response = await fetch("http://localhost:8000/auth", {
    method: "POST",
    mode: "cors",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      email,
      password,
    }),
  });
```

```diff lang="tsx"
// apps/workspace/app/components/sign-in-form.tsx
export function SignInForm() {
+   const [state, formAction] = useFormState(auth, null);
  return (
-    <form action={auth}>
+     <form action={formAction}>
      <CardContent className="space-y-2">
        <div className="space-y-1">
          <Label htmlFor="email">Email</Label>
          <Input
            id="email"
            name="email"
            type="email"
            placeholder="matsumoto_aki@example.com"
          />
+           {state?.fieldErrors.email && (
+             <p role="alert" className="text-red-500">
+               {state.fieldErrors.email}
+             </p>
+           )}
        </div>
        <div className="space-y-1">
          <Label htmlFor="password">Password</Label>
          <Input id="password" name="password" type="password" />
+           {state?.fieldErrors.password && (
+             <p role="alert" className="text-red-500">
+               {state.fieldErrors.password}
+             </p>
+           )}
        </div>
      </CardContent>
      <CardFooter>
        <Button>ログインする</Button>
      </CardFooter>
    </form>
  );
}
```

## なぜバリデーションが必要なのか？

## 参考リンク

- Next.js v14 で Form validation を server 側で行う https://cam-inc.co.jp/p/techblog/859745503506595841
