---
title: 4. Server Action ã‚’ä½¿ã£ã¦èªè¨¼ã™ã‚‹
description: 4. Server Action ã‚’ä½¿ã£ã¦èªè¨¼ã™ã‚‹
---
import { Aside } from '@astrojs/starlight/components';

## Sign-upã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

Sign-upã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

## ç¾çŠ¶ã®ç¢ºèª

ç¾åœ¨ã¯ã€Sign-upæ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
ã“ã‚Œã‹ã‚‰ã€Server Action ã‚’ä½¿ã£ã¦ Sign-up æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

## Server Action ã®ç°¡å˜ãªèª¬æ˜

Server Actions ã¨ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½ãªã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œã•ã‚Œã‚‹é–¢æ•°ã®ã“ã¨ã§ã™ã€‚

'use server' ã¨ã„ã†ç›®å°ã‚’æŒã¤é–¢æ•°ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã€Server Action ã¨ã—ã¦å®šç¾©ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```tsx
async function requestUsername(formData) {
  'use server';
  const username = formData.get('username');
  // ...
}

export default function App() {
  return (
    <form action={requestUsername}>
      <input type="text" name="username" />
      <button type="submit">Request</button>
    </form>
  );
}
```

ä¸Šè¨˜ã§ã„ã†ã¨ã€`requestUsername` ã¯ Server Action ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚
ä¸€è¦‹ã™ã‚‹ã¨ã€é€šå¸¸ã®é–¢æ•°ã¨å¤‰ã‚ã‚‰ãšã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§å®Ÿè¡Œã•ã‚Œãã†ã§ã™ãŒã€å®Ÿéš›ã«ã¯ form submit ã•ã‚ŒãŸéš›ã«ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã€ã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

typescript ã§å®Ÿè£…ã—ã¦ã„ã‚‹å ´åˆã¯å‹ã®æƒ…å ±ã‚’å–ã‚‹ã“ã¨ãŒã§ãã‚‹ãŸã‚ã€tRPC ãªã©ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ãªãã€å‹å®‰å…¨ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

## Server Action ã‚’ä½¿ã£ã¦ Sign-up æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹

ã¾ãšã¯ã€Sign-up ç”¨ã® Server Action ã‚’å®šç¾©ã—ã¾ã™ã€‚
`apps/workspace/app/actions.ts` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

```tsx
// apps/workspace/app/actions.ts
"use server";
import { cookies } from "next/headers";
import { redirect } from "next/navigation";

export async function auth(formData: FormData) {
  const email = formData.get("email") as string;
  const password = formData.get("password") as string;

  const response = await fetch("http://localhost:8000/auth", {
    method: "POST",
    mode: "cors",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      email,
      password,
    }),
  });
  if (response.ok) {
    const result = await response.json();
    cookies().set("___Host-auth", result.message);
    redirect("/inbox");
  }
  return null;
}
```

æ¬¡ã«ã€`apps/workspace/app/components/sign-up-form.tsx` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

```diff lang="tsx"
// apps/workspace/app/components/sign-up-form.tsx
+ import { auth } from "@/app/actions";
import { Button } from "@/components/ui/button";
import { CardContent, CardFooter } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";

export function SignInForm() {
  return (
-     <form>
+     <form action={auth}>
      <CardContent className="space-y-2">
```

action ã« `auth` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€Server Action ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
ã“ã‚Œã§ã€Sign-up æ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¾ã—ãŸã€‚

email ã¨ password ã‚’å…¥åŠ›ã—ã¦ Sign-up ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã‚µãƒ¼ãƒãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã€Sign-up ãŒå®Œäº†ã—ã¦ `/inbox` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™ã€‚

<Aside  type="danger">
  email ã¯ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒã§ç°¡å˜ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã§ã€`foo@example`ã®ã‚ˆã†ãªå€¤ã§ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

  ã“ã®æ™‚ç‚¹ã§ã¯Next.jså´ã§ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Ÿè£…ãŒãªã„ãŸã‚UIä¸Šã§ã¯ä½•ã‚‚èµ·ã“ã‚Šã¾ã›ã‚“ã€‚

  `foo@example.com`ã®ã‚ˆã†ãªå€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

  password ã¯ 1æ–‡å­—ä»¥ä¸Šã§ã‚ã‚Œã°å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚
</Aside>

## ãƒãƒ£ãƒ¬ãƒ³ã‚¸ğŸ’ª

login æ©Ÿèƒ½ã‚‚åŒæ§˜ã« Server Action ã‚’ä½¿ã£ã¦å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

`apps/workspace/app/components/login-form.tsx` ã® form action ã« auth é–¢æ•° (server action) ã‚’æŒ‡å®šã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚


## ã¾ã¨ã‚

Server Action ã‚’ä½¿ã£ã¦ Sign-up æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

Server Action ã‚’ä½¿ã†ã“ã¨ã§ã€ç°¡å˜ã«ã‚µãƒ¼ãƒãƒ¼å´ã«é€šä¿¡ã—ã¦ä½•ã‹ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€typescript ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€å‹æƒ…å ±ã‚’å–ã‚‹ã“ã¨ãŒã§ãã‚‹ãŸã‚ã€å‹å®‰å…¨ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

## å‚è€ƒãƒªãƒ³ã‚¯

- React Docs https://ja.react.dev/reference/rsc/use-server
- Next.js Docs https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations
